<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Birespi后台</title>
    <script src="/static/api.js"></script>
    <script src="/static/alpine.js"></script>
    <script src="/static/bootstrap.js"></script>
    <link href="/static/bootstrap.css" rel="stylesheet">
    <link href="/static/style.css" rel="stylesheet">


    <script>

        function setMainHeight() {
            // 获取nav元素
            const nav = document.querySelector('nav');
            // 获取main元素
            const main = document.querySelector('main');
            // 获取nav元素的高度
            const navHeight = nav.offsetHeight;
            // 获取界面高度
            const windowHeight = window.innerHeight;
            // 设置main元素的高度
            main.style.height = windowHeight - navHeight + 'px';
        }

        window.addEventListener('load', function () {
            setMainHeight();
        });

        window.addEventListener('resize', function () {
            setMainHeight();
        });

        function app() {
            return {
                danmus: [],
                danmuAutoScroll: true,
                init() {
                    danmuList = document.getElementById('danmu_list');

                    setInterval(async () => {
                        const getDanmusResult = await getDanmus();
                        if (getDanmusResult != 0) {

                            const danmus = getDanmusResult.data.danmus;
                            this.danmus = danmus;
                            console.log(this.danmus);

                            if (this.danmuAutoScroll) {
                                danmuList.scrollTop = danmuList.scrollHeight;
                            }

                        }
                    }, 1000);
                }
            };
        }


        document.addEventListener('DOMContentLoaded', function () {
        });


    </script>

    <style>
        main {
            padding: 24px;
            overflow: hidden;
            background-color: bisque;
        }

        .user_avatar {
            width: 32px;
            height: 32px;
            padding: 4px;
            border-radius: 50%;
            border: 1px solid #ccc;
        }

        .danmu_list {
            height: 0px;
            overflow-y: scroll;
        }
    </style>
</head>

<body x-data="app()" x-init="init()">

    <nav class="navbar navbar-expand-lg bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Birespi后台</a>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#">主页</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">配置</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="main d-flex flex-column">
        <div class="row h-100">
            <div class="col-3">
                <div class="card h-100 ">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <div>弹幕</div>
                        <div>
                            <label class="form-check-label" for="flexCheckDefault">
                                自动滚到底部
                            </label>
                            <input class="form-check-input" type="checkbox" x-model="danmuAutoScroll"
                                x-on:click="danmuAutoScroll = ! danmuAutoScroll">
                        </div>

                    </div>
                    <div id="danmu_list" class="card-body danmu_list">

                        <template x-for="danmu in danmus">
                            <div style="display: block; margin-bottom: 10px;" class="toast" role="alert"
                                aria-live="assertive" aria-atomic="true">
                                <div class="toast-header">
                                    <img class="user_avatar" src="/static/user.png" class="rounded me-2" alt="用户头像">
                                    &nbsp;
                                    <strong class="me-auto" x-text="danmu.from_user"></strong>
                                    <small>11 mins ago</small>
                                    <button type="button" class="btn-close" data-bs-dismiss="toast"
                                        aria-label="Close"></button>
                                </div>
                                <div class="toast-body" x-text="danmu.data.content">
                                </div>
                            </div>

                            <div style="height: 12px;"></div>
                            <div style="height: 12px;"></div>
                            <div style="height: 12px;"></div>
                        </template>

                    </div>
                </div>
            </div>
            <div class="col-9">
                <div class="row h-75 pb-3">
                    <div class="card ps-0 pe-0">
                        <div class="card-header">
                            数据统计
                        </div>
                        <div class="card-body">
                            <h1>数据统计</h1>
                            <p>这是一个数据统计</p>
                        </div>
                    </div>
                </div>

                <div class="row h-25">


                    <div class="card ps-0 pe-0">
                        <div class="card-header">
                            正在回复
                        </div>
                        <div class="card-body">
                            <h1>欢迎来到正在回复</h1>
                            <p>这是一个正在回复</p>
                        </div>
                    </div>
                </div>
            </div>
    </main>

</body>

</html>